<html>
  <body>
    <style>
      #outgoing {
        width: 600px;
        word-wrap: break-word;
      }
    </style>
<video id="video" autoplay></video>
    <form>
      <textarea id="incoming"></textarea>
      <button type="submit">submit</button>
    </form>
    <pre id="outgoing"></pre>
<div id="data">_____</div>
    <div id="myId">null</div>

    Address:<br>
<textarea id="myTextarea"></textarea>

<p>Click the button to get the content of the text area.</p>

<button type="button" onclick="myFunction()">Try it</button>


    <script src="bundle.js"></script>

	<script src="https://cdn.netpie.io/microgear.js"></script>

<script>
  const APPID     = 'kisramodul';
  const APPKEY    = 'heLwJbuvST8Wjm7';
  const APPSECRET = 'VZ4a6MTsJLdZp8Opv9YKhnlMJ';

  var send = false;
  var mySinnal = '';
  var idd;

	var microgear = Microgear.create({
		key: APPKEY,
		secret: APPSECRET,
		alias : "myhtml"         /*  optional  */
	});

	microgear.on('message',function(topic,msg) {
		document.getElementById("data").innerHTML = msg;
		if (msg.toString() === 'getSinnal') {
		    microgear.publish("/video/temp/" + idd, mySinnal);
        }
	});

	microgear.on('connected', function() {
		// microgear.setAlias('htmlgear');    /* alias can be renamed anytime with this function */
		document.getElementById("data").innerHTML = "Now I am connected with netpie...";
		idd = Math.random().toString()
		document.getElementById("myId").innerHTML = idd;
		microgear.setAlias(idd);
		console.log('my name'+idd)

		setInterval(function() {
		    if (mySinnal === ''){
		        mySinnal = document.getElementById("outgoing").innerText;
            } else {
		        console.log("mySinnal data length"+mySinnal.length);
            }
			// microgear.chat("htmlgear","Hello from myself at "+Date.now());
            // mySinnal = document.getElementById("outgoing").innerText;
            // if (mySinnal !== '' && send === false) {
            //     var mid = document.getElementById("myId").value;
            //     microgear.publish("/video/temp/"+mid,mySinnal, true);
            //     console.log("publish to /video/temp/1");
            //     console.log("data length"+mySinnal.length);
            //     send = true;
            // }
		},2000);
	});

	microgear.on('present', function(event) {
		console.log(event);
	});

	microgear.on('absent', function(event) {
		console.log(event);
	});

	microgear.connect(APPID);

	function myFunction() {
    var x = document.getElementById("myTextarea").value;
    microgear.subscribe("/video/temp/"+x);
    console.log("/video/temp/"+x);
    microgear.chat(x.toString(),"getSinnal");
}
</script>

  </body>
</html>
